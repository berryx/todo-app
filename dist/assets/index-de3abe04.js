var m=Object.defineProperty;var u=(i,t,e)=>t in i?m(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(u(i,typeof t!="symbol"?t+"":t,e),e),f=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var l=(i,t,e)=>(f(i,t,"read from private field"),e?e.call(i):t.get(i)),h=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)};(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();function c(i){return i.toLocaleDateString()}function p(i){const[t,e,s]=i.split("/");return new Date(`${s}-${e}-${t}`).toISOString().slice(0,10)}class g{constructor(t,e){r(this,"onTodoListChange",t=>{this.render.updateTodoListRender(t)});r(this,"handleEvent",t=>{switch(this.render.onEvent(this.handleEvent),t.type){case"click":t.target.classList.contains("delete-btn")?this.handleTodoDelete(t):t.target.classList.contains("date")&&this.handleDateEdit(t);break;case"submit":this.handleSubmit(t);break;case"change":t.target.type==="checkbox"&&this.handleToggleTodo(t);break;case"focusout":t.target.getAttribute("name")==="title"&&this.handleEdit(t);break}});r(this,"handleTodoDelete",t=>{const e=parseInt(t.target.parentNode.id);this.todolist.removeTodo(e)});r(this,"handleToggleTodo",t=>{const e=parseInt(t.target.parentNode.id);this.todolist.toggleCompleted(e)});r(this,"handleEdit",t=>{const e=t.target.textContent,s=t.target.parentNode.id;this.todolist.editTodo(parseInt(s),e)});r(this,"handleDateEdit",t=>{let e=document.createElement("input");e.setAttribute("type","date");let s=t.target;e.value=p(s.textContent),t.target.parentNode.replaceChild(e,t.target),e.addEventListener("change",o=>{let n=o.target.value,d=o.target.parentNode.id;this.todolist.editDate(d,n)})});r(this,"handleSubmit",t=>{t.preventDefault(),console.log("In handle submit App.js");const e=new FormData(t.currentTarget);let s=e.get("title").trim(),o=e.get("date");if(!s){t.currentTarget.firstElementChild.placeholder="The task is empty...";return}const n={title:s,date:o};t.currentTarget.reset(),t.currentTarget.parentNode.classList.replace("visible","hidden"),this.todolist.addTodo(n)});this.todolist=t,this.render=e,this.todolist.subscribe(this.onTodoListChange),this.onTodoListChange(this.todolist.todos),this.render.onEvent(this.handleEvent)}}const y=[{title:"First task",isCompleted:!1,date:"2023-04-27"},{title:"Second task"},{title:"Third task",isCompleted:!0}];class E{constructor(t,e,s,o){r(this,"title");this.id=e,this.title=t,this.date=(o?c(new Date(o)):!1)||c(new Date(Date.now())),this.isCompleted=s||!1}set title(t){this._title=t.trim()}set description(t){this._title=t.trim()}}var a;class T{constructor(){r(this,"todos",[]);h(this,a,[]);this.addTodo(y.map(t=>t))}subscribe(t){l(this,a).push(t)}notify(t){l(this,a).forEach(e=>e(t))}addTodo(t){if(Array.isArray(t)){for(const e of t)this.addTodo(e);this.notify(this.todos)}else{const e=new E(t.title,this.todos.length>0?this.todos[this.todos.length-1].id+1:1,t.isCompleted?t.isCompleted:!1,t.date);this.todos.push(e),this.notify(this.todos)}}removeTodo(t){this.todos=this.todos.filter(e=>e.id!==t),this.notify(this.todos)}toggleCompleted(t){const e=this.todos.findIndex(s=>s.id===t);this.todos[e].isCompleted=!this.todos[e].isCompleted,this.notify(this.todos)}editTodo(t,e){const s=this.todos.findIndex(o=>o.id===t);this.todos[s].title=e,this.notify(this.todos)}editDate(t,e){const s=this.todos.findIndex(o=>o.id===Number(t));this.todos[s].date=c(new Date(Date.parse(e))),this.notify(this.todos)}}a=new WeakMap;const L=i=>document.querySelector(i).content.cloneNode(!0).firstElementChild;class b{constructor(){this.todoElements=[],this.formContainer=document.querySelector("#add-form-container"),this.todoListElement=document.querySelector("#todolist"),this.displayFormBtn=document.querySelector("#create-form-button")}updateTodoListRender(t){this.createTodoElements(t),this.todoListElement.replaceChildren(...this.todoElements)}onEvent(t){this.displayFormBtn.addEventListener("click",this.displayForm.bind(this)),this.formContainer.querySelector("#add-form").addEventListener("submit",t),this.formContainer.querySelector("#remove-form").addEventListener("click",this.removeForm.bind(this)),this.todoListElement.addEventListener("click",t),this.todoListElement.addEventListener("change",t),this.todoListElement.addEventListener("focusout",t)}displayForm(){this.formElement=document.querySelector("#add-form");let t=this.formElement.querySelector("#date");t.value=new Date(Date.now()).toISOString().slice(0,10),this.formContainer.classList.replace("hidden","visible")}removeForm(){this.formContainer.classList.replace("visible","hidden")}createTodoElements(t){this.todoElements=[];for(const e of t){const s=L("#todo-template");s.id=e.id;const o=s.querySelector(".task");o.textContent=e.title,o.contentEditable=!0;const n=s.querySelector("input");n.checked=e.isCompleted,n.checked&&(o.style.textDecoration="line-through",o.style.opacity="0.6",s.classList.add("checked"));const d=s.querySelector(".date");d.textContent=e.date,this.todoElements.push(s)}}}new g(new T,new b);
